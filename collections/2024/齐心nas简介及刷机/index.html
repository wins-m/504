<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  齐心NAS简介及刷机 · WM&#39;s Blog
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://www.youtube.com; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdn.jsdelivr.net/; connect-src 'self' https://www.google-analytics.com;">




<meta name="author" content="WM">
<meta name="description" content="src

齐心NAS（SY-100）简介
出厂系统简介
刷机方案简介
刷机方案1（不拆机U盘玩转istore、群晖和原厂系统多启动）
刷机方案2（硬改spi方案）

拆机流程
TTL接法（非必须，可用于折腾，研究，救砖）
定制固件
硬改流程
硬改方案启动其它系统

spi方案自动刷入nand铁威马并启动nand铁威马
spi方案启动U盘istore
spi方案恢复启动群晖




群晖系统（spi和U盘通用）启动后优化
其他进阶教程（没有变砖不用看）

线刷教程（可用于写入bootloader，救砖）原厂bootloader文件在网盘里
ctrl-q模式终极救砖




  齐心NAS简介及刷机
  
    
    Link to heading
  


  齐心NAS（SY-100）简介
  
    
    Link to heading
  


没错就是做文具的那个齐心，这个产品在官网仍有简介，显示已下架，网址显示是b2b产品
简单看下官方简介









其它需要说明的
经测试，齐心的官方app已经不能使用。
经拆机显示，内部存储方案为nand，使用mx30LF2G18AC的256M芯片，内存为2颗K4B4G1646E 512M DDR3芯片，总内存1GB
做工和外观真心不错，硬盘架结合了按压弹出和热插拔的设计，螺丝孔兼容3.5寸硬盘和2.5寸硬盘，接触硬盘部分还有硅胶防震机制



  出厂系统简介
  
    
    Link to heading
  



原机自带的是基于realtek sdk的openwrt，不出意外的意外就是内核4.4，op版本15.05,root密码是1234
">
<meta name="keywords" content="blog,developer,personal">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="齐心NAS简介及刷机">
  <meta name="twitter:description" content="src
齐心NAS（SY-100）简介 出厂系统简介 刷机方案简介 刷机方案1（不拆机U盘玩转istore、群晖和原厂系统多启动） 刷机方案2（硬改spi方案） 拆机流程 TTL接法（非必须，可用于折腾，研究，救砖） 定制固件 硬改流程 硬改方案启动其它系统 spi方案自动刷入nand铁威马并启动nand铁威马 spi方案启动U盘istore spi方案恢复启动群晖 群晖系统（spi和U盘通用）启动后优化 其他进阶教程（没有变砖不用看） 线刷教程（可用于写入bootloader，救砖）原厂bootloader文件在网盘里 ctrl-q模式终极救砖 齐心NAS简介及刷机 Link to heading 齐心NAS（SY-100）简介 Link to heading 没错就是做文具的那个齐心，这个产品在官网仍有简介，显示已下架，网址显示是b2b产品 简单看下官方简介 其它需要说明的 经测试，齐心的官方app已经不能使用。 经拆机显示，内部存储方案为nand，使用mx30LF2G18AC的256M芯片，内存为2颗K4B4G1646E 512M DDR3芯片，总内存1GB 做工和外观真心不错，硬盘架结合了按压弹出和热插拔的设计，螺丝孔兼容3.5寸硬盘和2.5寸硬盘，接触硬盘部分还有硅胶防震机制 出厂系统简介 Link to heading 原机自带的是基于realtek sdk的openwrt，不出意外的意外就是内核4.4，op版本15.05,root密码是1234 ">

<meta property="og:url" content="https://wins-m.github.io/504/collections/2024/%E9%BD%90%E5%BF%83nas%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%88%B7%E6%9C%BA/">
  <meta property="og:site_name" content="WM&#39;s Blog">
  <meta property="og:title" content="齐心NAS简介及刷机">
  <meta property="og:description" content="src
齐心NAS（SY-100）简介 出厂系统简介 刷机方案简介 刷机方案1（不拆机U盘玩转istore、群晖和原厂系统多启动） 刷机方案2（硬改spi方案） 拆机流程 TTL接法（非必须，可用于折腾，研究，救砖） 定制固件 硬改流程 硬改方案启动其它系统 spi方案自动刷入nand铁威马并启动nand铁威马 spi方案启动U盘istore spi方案恢复启动群晖 群晖系统（spi和U盘通用）启动后优化 其他进阶教程（没有变砖不用看） 线刷教程（可用于写入bootloader，救砖）原厂bootloader文件在网盘里 ctrl-q模式终极救砖 齐心NAS简介及刷机 Link to heading 齐心NAS（SY-100）简介 Link to heading 没错就是做文具的那个齐心，这个产品在官网仍有简介，显示已下架，网址显示是b2b产品 简单看下官方简介 其它需要说明的 经测试，齐心的官方app已经不能使用。 经拆机显示，内部存储方案为nand，使用mx30LF2G18AC的256M芯片，内存为2颗K4B4G1646E 512M DDR3芯片，总内存1GB 做工和外观真心不错，硬盘架结合了按压弹出和热插拔的设计，螺丝孔兼容3.5寸硬盘和2.5寸硬盘，接触硬盘部分还有硅胶防震机制 出厂系统简介 Link to heading 原机自带的是基于realtek sdk的openwrt，不出意外的意外就是内核4.4，op版本15.05,root密码是1234 ">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="collections">
    <meta property="article:published_time" content="2024-09-22T20:16:03+08:00">
    <meta property="article:modified_time" content="2024-09-22T20:16:03+08:00">
    <meta property="article:tag" content="玩机">




<link rel="canonical" href="https://wins-m.github.io/504/collections/2024/%E9%BD%90%E5%BF%83nas%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%88%B7%E6%9C%BA/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/504/css/coder.min.aa5ef26fa979d6793724ae2dbd71efa94fd16cb1c5c7db3b6651f21f9892a5fd.css" integrity="sha256-ql7yb6l51nk3JK4tvXHvqU/RbLHFx9s7ZlHyH5iSpf0=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/504/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://wins-m.github.io/504/">
      WM&#39;s Blog
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/504/posts/">Posts</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/504/notes/">Notes</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/504/collections">Collections</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/504/tags">Tags</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/504/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://wins-m.github.io/504/collections/2024/%E9%BD%90%E5%BF%83nas%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%88%B7%E6%9C%BA/">
          齐心NAS简介及刷机
        </a>
      </h1>
    </header>

    <p><a href="https://lajilao.top/thread-126-1-1.html"  class="external-link" target="_blank" rel="noopener">src</a></p>
<ul>
<li><a href="#%e9%bd%90%e5%bf%83nassy-100%e7%ae%80%e4%bb%8b" >齐心NAS（SY-100）简介</a></li>
<li><a href="#%e5%87%ba%e5%8e%82%e7%b3%bb%e7%bb%9f%e7%ae%80%e4%bb%8b" >出厂系统简介</a></li>
<li><a href="#%e5%88%b7%e6%9c%ba%e6%96%b9%e6%a1%88%e7%ae%80%e4%bb%8b" >刷机方案简介</a></li>
<li><a href="#%e5%88%b7%e6%9c%ba%e6%96%b9%e6%a1%881%e4%b8%8d%e6%8b%86%e6%9c%bau%e7%9b%98%e7%8e%a9%e8%bd%acistore%e7%be%a4%e6%99%96%e5%92%8c%e5%8e%9f%e5%8e%82%e7%b3%bb%e7%bb%9f%e5%a4%9a%e5%90%af%e5%8a%a8" >刷机方案1（不拆机U盘玩转istore、群晖和原厂系统多启动）</a></li>
<li><a href="#%e5%88%b7%e6%9c%ba%e6%96%b9%e6%a1%882%e7%a1%ac%e6%94%b9spi%e6%96%b9%e6%a1%88" >刷机方案2（硬改spi方案）</a>
<ul>
<li><a href="#%e6%8b%86%e6%9c%ba%e6%b5%81%e7%a8%8b" >拆机流程</a></li>
<li><a href="#ttl%e6%8e%a5%e6%b3%95%e9%9d%9e%e5%bf%85%e9%a1%bb%e5%8f%af%e7%94%a8%e4%ba%8e%e6%8a%98%e8%85%be%e7%a0%94%e7%a9%b6%e6%95%91%e7%a0%96" >TTL接法（非必须，可用于折腾，研究，救砖）</a></li>
<li><a href="#%e5%ae%9a%e5%88%b6%e5%9b%ba%e4%bb%b6" >定制固件</a></li>
<li><a href="#%e7%a1%ac%e6%94%b9%e6%b5%81%e7%a8%8b" >硬改流程</a></li>
<li><a href="#%e7%a1%ac%e6%94%b9%e6%96%b9%e6%a1%88%e5%90%af%e5%8a%a8%e5%85%b6%e5%ae%83%e7%b3%bb%e7%bb%9f" >硬改方案启动其它系统</a>
<ul>
<li><a href="#spi%e6%96%b9%e6%a1%88%e8%87%aa%e5%8a%a8%e5%88%b7%e5%85%a5nand%e9%93%81%e5%a8%81%e9%a9%ac%e5%b9%b6%e5%90%af%e5%8a%a8nand%e9%93%81%e5%a8%81%e9%a9%ac" >spi方案自动刷入nand铁威马并启动nand铁威马</a></li>
<li><a href="#spi%e6%96%b9%e6%a1%88%e5%90%af%e5%8a%a8u%e7%9b%98istore" >spi方案启动U盘istore</a></li>
<li><a href="#spi%e6%96%b9%e6%a1%88%e6%81%a2%e5%a4%8d%e5%90%af%e5%8a%a8%e7%be%a4%e6%99%96" >spi方案恢复启动群晖</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%e7%be%a4%e6%99%96%e7%b3%bb%e7%bb%9fspi%e5%92%8cu%e7%9b%98%e9%80%9a%e7%94%a8%e5%90%af%e5%8a%a8%e5%90%8e%e4%bc%98%e5%8c%96" >群晖系统（spi和U盘通用）启动后优化</a></li>
<li><a href="#%e5%85%b6%e4%bb%96%e8%bf%9b%e9%98%b6%e6%95%99%e7%a8%8b%e6%b2%a1%e6%9c%89%e5%8f%98%e7%a0%96%e4%b8%8d%e7%94%a8%e7%9c%8b" >其他进阶教程（没有变砖不用看）</a>
<ul>
<li><a href="#%e7%ba%bf%e5%88%b7%e6%95%99%e7%a8%8b%e5%8f%af%e7%94%a8%e4%ba%8e%e5%86%99%e5%85%a5bootloader%e6%95%91%e7%a0%96%e5%8e%9f%e5%8e%82bootloader%e6%96%87%e4%bb%b6%e5%9c%a8%e7%bd%91%e7%9b%98%e9%87%8c" >线刷教程（可用于写入bootloader，救砖）原厂bootloader文件在网盘里</a></li>
<li><a href="#ctrl-q%e6%a8%a1%e5%bc%8f%e7%bb%88%e6%9e%81%e6%95%91%e7%a0%96" >ctrl-q模式终极救砖</a></li>
</ul>
</li>
</ul>
<h2 id="齐心nas简介及刷机">
  齐心NAS简介及刷机
  <a class="heading-link" href="#%e9%bd%90%e5%bf%83nas%e7%ae%80%e4%bb%8b%e5%8f%8a%e5%88%b7%e6%9c%ba">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h1 id="齐心nassy-100简介">
  齐心NAS（SY-100）简介
  <a class="heading-link" href="#%e9%bd%90%e5%bf%83nassy-100%e7%ae%80%e4%bb%8b">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<ul>
<li>没错就是做文具的那个齐心，这个产品在官网仍有<a href="https://b2b.comix.com.cn/13339.html"  class="external-link" target="_blank" rel="noopener">简介</a>，显示已下架，网址显示是b2b产品</li>
<li>简单看下官方简介
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=10e6de94f269a75414fb2c88f499ac1d">
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=dfb5a1233ad4b35dbe086042bf1b8c74"></li>
</ul>
<p><img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=7a193d9c368d0be512afa0fdf62413d7"></p>
<p><img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=e2bba53eeaf3cb619a3f10d234760356"></p>
<p><img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=aa85a603fe4b73d3e2cfcccbd5898668"></p>
<p><img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=5676f90015d08bae3eacae4b91c5f083"></p>
<p><img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=e67b12372cdd7f1742a6345beee4d008"></p>
<ul>
<li>其它需要说明的
经测试，齐心的官方app已经不能使用。
经拆机显示，内部存储方案为nand，使用mx30LF2G18AC的256M芯片，内存为2颗K4B4G1646E 512M DDR3芯片，总内存1GB
做工和外观真心不错，硬盘架结合了按压弹出和热插拔的设计，螺丝孔兼容3.5寸硬盘和2.5寸硬盘，接触硬盘部分还有硅胶防震机制</li>
</ul>
<p><img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=7132a16f520632ba967160484dc781fa"></p>
<h1 id="出厂系统简介">
  出厂系统简介
  <a class="heading-link" href="#%e5%87%ba%e5%8e%82%e7%b3%bb%e7%bb%9f%e7%ae%80%e4%bb%8b">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<ul>
<li>
<p>原机自带的是基于realtek sdk的openwrt，不出意外的意外就是内核4.4，op版本15.05,root密码是1234
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=c2a2647f44e9e596a069fd4d074db734"></p>
</li>
<li>
<p>原系统下，支持raid管理，支持transsmition下载，支持samba，支持ftp等常用nas功能。
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=ef806e1199ab70a9d28da2c80cad818a">
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=479811a51b04473515d8ef90ada4a360"></p>
</li>
<li>
<p>安装软件，开启ssh
原系统删除了ssh，并且是英文，我们来开启op15的软件安装
1.选择system-software菜单，点击configuration选项卡，原来是这样的
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=37b71f740e6cabe07900d687bda0d346">
2.在configuration填入</p>
<pre tabindex="0"><code>arch all 100
arch rtd1295 200
arch arm64 300
</code></pre><p>在feeds里填入</p>
<pre tabindex="0"><code>src/gz chaos_calmer_base https://archive.openwrt.org/chaos_calmer/15.05/arm64/generic/packages/base
src/gz chaos_calmer_luci   https://archive.openwrt.org/chaos_calmer/15.05/arm64/generic/packages/luci
src/gz chaos_calmer_management https://archive.openwrt.org/chaos_calmer/15.05/arm64/generic/packages/management
src/gz chaos_calmer_packages  https://archive.openwrt.org/chaos_calmer/15.05/arm64/generic/packages/packages
src/gz chaos_calmer_routing  https://archive.openwrt.org/chaos_calmer/15.05/arm64/generic/packages/routing
src/gz chaos_calmer_telephony  https://archive.openwrt.org/chaos_calmer/15.05/arm64/generic/packages/telephony
</code></pre></li>
</ul>
<p>3.改完后是这样的
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=c4a58a3dad4e2a578aa3e3738ee9c54f">
4.点击update list ，可以安装部分软件了，比如dropbear,luci*zh-cn语言包
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=700d8ac4f4e6bad510dc91f75f8f0ab0">
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=df192bfc1c8b394abaf252dc85bf8640"></p>
<h1 id="刷机方案简介">
  刷机方案简介
  <a class="heading-link" href="#%e5%88%b7%e6%9c%ba%e6%96%b9%e6%a1%88%e7%ae%80%e4%bb%8b">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<ul>
<li>由于nand存储方案限制，目前基于rtd1296的芝杜和istoreos都是使用emmc存储方案，硬件限制无法刷机。如果硬改emmc，则可以通过简单修改dtb刷入istoreos，同时主板上有hdmi焊盘，如果补齐hdmi接口和相关电路，理论也可以刷入芝杜。由于涉及硬改复杂，不在本次刷机探讨范围。</li>
<li>刷群晖，这个机器的硬件配置和外观最适合nas系统，也是本次探讨的主要内容</li>
</ul>
<ol>
<li>不拆机器，利用ssh修改原厂uboot的env。该env经过我设计和测试，就是能启动U盘群晖就启动群晖，如果U盘不存在就启动原厂系统，从而实现不拆及双系统。启动群晖的原理是，在一个有spi的机器上进行正常安装后重启时，可将硬盘文件和spi引导文件备份出来，分别写入U盘和硬盘，并用boot引导U盘的群晖引导（对应spi备份），配合硬盘备份，能够使群晖系统认为已经完成安装，从而实现群晖系统启动。唯一的缺陷是无法更新系统，因为在更新系统中必须要写入spi，而不硬改的机器没有spi。具体文件和刷机流程请参见刷机方案1</li>
<li>直接硬改，主板上有空spi焊盘，焊接群晖支持的spi flash型号，建议为w25q64，然后改动启动电阻，使soc直接从spi启动。改完后，所有启动流程与白裙一致，因而也可以升级，如果sn和mac正确，就可以qc。具体方法和流程请参考刷机方案2.
3.上述两个方案启动不通系统的原理都是基于uboot，设计不同uboot启动命令而已，spi boot方案比原厂boot多了lzma功能和spi读写功能，因而可以启动spi系统，所有boot都支持启动U盘istore、群晖，nand铁威马。</li>
</ol>
<h1 id="刷机方案1不拆机u盘玩转istore群晖和原厂系统多启动">
  刷机方案1（不拆机U盘玩转istore、群晖和原厂系统多启动）
  <a class="heading-link" href="#%e5%88%b7%e6%9c%ba%e6%96%b9%e6%a1%881%e4%b8%8d%e6%8b%86%e6%9c%bau%e7%9b%98%e7%8e%a9%e8%bd%acistore%e7%be%a4%e6%99%96%e5%92%8c%e5%8e%9f%e5%8e%82%e7%b3%bb%e7%bb%9f%e5%a4%9a%e5%90%af%e5%8a%a8">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>1.下载网盘中不拆机文件夹中的comix-istore-ds218.img.gz，文件地址：链接：https://pan.baidu.com/s/1Bw-CecPLjwOThpmdwuna8A?pwd=5hm5 提取码：5hm5
使用<a href="https://etcher.balena.io/#download-etcher"  class="external-link" target="_blank" rel="noopener">balancetcher</a>将这个文件写入 U盘（大于4G），无需解压写入，软件支持自动解压并写入
2.将写好的U盘插入机器，并确保没有硬盘插入，开机且按照原厂教程安装dropbear并ssh登录
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=389d985b16e558fb1c41d9ede08247f3">
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=816fe21fbb638d2cbd1473426b1c5e5b">
3.将U盘中支持多启动的factory写入写入nand（已经安装过原群晖启动的，如果需要多启动，直接与新用户一样更新factory），并验证
写入命令为<code>dd if=/mnt/sda1/factory.bin of=/dev/mtdblock0 bs=$((0x20000)) seek=38 count=4 conv=notrunc</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@OpenWrt:# dd <span class="k">if</span><span class="o">=</span>/mnt/sda1/factory.bin <span class="nv">of</span><span class="o">=</span>/dev/mtdblock0 <span class="nv">bs</span><span class="o">=</span><span class="k">$((</span><span class="m">0</span>x20000<span class="k">))</span> <span class="nv">seek</span><span class="o">=</span><span class="m">38</span> <span class="nv">count</span><span class="o">=</span><span class="m">4</span> <span class="nv">conv</span><span class="o">=</span>notrunc
</span></span><span class="line"><span class="cl">4+0 records in
</span></span><span class="line"><span class="cl">4+0 records out
</span></span><span class="line"><span class="cl"><span class="m">524288</span> bytes <span class="o">(</span><span class="m">524</span> kB<span class="o">)</span> copied, 0.176786 s, 3.0 MB/s
</span></span></code></pre></div><p>使用factory load和list命令验证，可以看到boot_syno，syno_bootargs，boot_istore，bootcmd变为如下所示，先启动U盘istore，失败后启动U盘群晖，再失败后启动原厂op</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">root@OpenWrt# factory load
</span></span><span class="line"><span class="cl"><span class="nv">argc</span> <span class="o">=</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="nv">argv</span> <span class="o">=</span> factory load
</span></span><span class="line"><span class="cl">root@OpenWrt# factory list
</span></span><span class="line"><span class="cl">……前面省略
</span></span><span class="line"><span class="cl"><span class="nv">boot_syno</span><span class="o">=</span>fatload usb <span class="m">0</span> <span class="nv">$audio_loadaddr</span> /ds218/bluecore.audio<span class="p">;</span>fatload usb <span class="m">0</span> <span class="nv">$fdt_loadaddr</span> /ds218/comix4ds218.dtb<span class="p">;</span>fatload usb <span class="m">0</span> <span class="nv">$rootfs_loadaddr</span> /ds218/rd.bin<span class="p">;</span>ping 192.168.1.254<span class="p">;</span>go all<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">syno_bootargs</span><span class="o">=</span>setenv bootargs <span class="s2">&#34;ip=off console=ttyS0,115200 root=/dev/md0 rw  syno_castrated_xhc=xhci-hcd.5.auto@1 syno_usb_vbus_gpio=102@xhci-hcd.2.auto@0,19@xhci-hcd.5.auto@0,16@xhci-hcd.8.auto@0 syno_hw_version=DS218 hd_power_on_seq=2 ihd_num=2 phys_memsize=1024 netif_num=1 audio_version=1012363 syno_fw_version=M.506 sn=1830QEN339808 mac1=0011328CE51F&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">boot_istore</span><span class="o">=</span>fatload usb <span class="m">0</span> <span class="nv">$audio_loadaddr</span> /istore/bluecore.audio<span class="p">;</span>fatload usb <span class="m">0</span> <span class="nv">$fdt_loadaddr</span> /istore/comix-rtd-129x.dtb<span class="p">;</span>go all<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">bootcmd</span><span class="o">=</span>usb start<span class="p">;</span><span class="k">if</span> fatload usb <span class="m">0</span> <span class="nv">$kernel_loadaddr</span> /istore/rtd129x.image<span class="p">;</span><span class="k">then</span> run boot_istore<span class="p">;</span><span class="k">else</span> <span class="k">if</span> fatload usb <span class="m">0</span> <span class="nv">$kernel_loadaddr</span> /ds218/Image<span class="p">;</span><span class="k">then</span> run syno_bootargs<span class="p">;</span>run boot_syno<span class="p">;</span><span class="k">fi</span><span class="p">;</span><span class="k">fi</span><span class="p">;</span>bootr<span class="p">;</span>
</span></span><span class="line"><span class="cl">……后面省略
</span></span><span class="line"><span class="cl"><span class="o">===============</span>
</span></span></code></pre></div><p>4.第三部验证成功的不用进行该步骤，只有factroy list验证发现这四个变量缺少，可能是刚好存储factory的nand位置有坏块，需要下面步骤。
同时，上述方案仅适用于原厂boot，因为写入的是nand存储，可以通过拆机，连接ttl，直接进uboot手动设置这四个变量，uboot保存时会跳过nand坏块
<strong>手动命令方式设置多启动通用nand原厂boot、spiboot，也就是改了spi的机器同样可以使用下面命令设置从U盘启动istore和群晖。</strong>
第一步是按照主板图连接ttl，用串口软件打开，设置为115200，8n1
第二步插电同时按按esc中断uboot
第三步手动设置env，输入命令前先按2个回车，因为首条命令总是错误</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Checking default environment
</span></span><span class="line"><span class="cl">Hit Esc or Tab key to enter console mode or rescue linux: <span class="m">0</span>
</span></span><span class="line"><span class="cl">——————can’t find tmp/factory/recovery
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Press Esc Key
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Enter console mode, disable watchdog …
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Realtek&gt;
</span></span><span class="line"><span class="cl"> nknown <span class="nb">command</span> ‘ry ‘help’
</span></span><span class="line"><span class="cl"> Realtek&gt;
</span></span><span class="line"><span class="cl"> Realtek&gt; setenv boot_syno ‘fatload usb <span class="m">0</span> <span class="nv">$audio_loadaddr</span> /ds218/bluecore.audio<span class="p">;</span>fatload usb <span class="m">0</span> <span class="nv">$fdt_loadaddr</span> /ds218/comix4ds218.dtb<span class="p">;</span>fatload usb <span class="m">0</span> <span class="nv">$rootfs_loadaddr</span> /ds218/rd.bin<span class="p">;</span>ping 192.168.1.254<span class="p">;</span>go all<span class="p">;</span>’
</span></span><span class="line"><span class="cl"> Realtek&gt; setenv syno_bootargs ‘setenv bootargs “ip<span class="o">=</span>off <span class="nv">console</span><span class="o">=</span>ttyS0,115200 <span class="nv">root</span><span class="o">=</span>/dev/md0 rw <span class="nv">syno_castrated_xhc</span><span class="o">=</span>xhci-hcd.5.auto@1 <span class="nv">syno_usb_vbus_gpio</span><span class="o">=</span>102@xhci-hcd.2.auto@0,19@xhci-hcd.5.auto@0,16@xhci-hcd.8.auto@0 <span class="nv">syno_hw_version</span><span class="o">=</span>DS218 <span class="nv">hd_power_on_seq</span><span class="o">=</span><span class="m">2</span> <span class="nv">ihd_num</span><span class="o">=</span><span class="m">2</span> <span class="nv">phys_memsize</span><span class="o">=</span><span class="m">1024</span> <span class="nv">netif_num</span><span class="o">=</span><span class="m">1</span> <span class="nv">audio_version</span><span class="o">=</span><span class="m">1012363</span> <span class="nv">syno_fw_version</span><span class="o">=</span>M.506 <span class="nv">sn</span><span class="o">=</span>1830QEN339808 <span class="nv">mac1</span><span class="o">=</span>0011328CE51F”‘
</span></span><span class="line"><span class="cl"> Realtek&gt; setenv boot_istore ‘fatload usb <span class="m">0</span> <span class="nv">$audio_loadaddr</span> /istore/bluecore.audio<span class="p">;</span>fatload usb <span class="m">0</span> <span class="nv">$fdt_loadaddr</span> /istore/comix-rtd-129x.dtb<span class="p">;</span>go all<span class="p">;</span>’
</span></span><span class="line"><span class="cl"> Realtek&gt; setenv bootcmd ‘usb start<span class="p">;</span><span class="k">if</span> fatload usb <span class="m">0</span> <span class="nv">$kernel_loadaddr</span> /istore/rtd129x.image<span class="p">;</span><span class="k">then</span> run boot_istore<span class="p">;</span><span class="k">else</span> <span class="k">if</span> fatload usb <span class="m">0</span> <span class="nv">$kernel_loadaddr</span> /ds218/Image<span class="p">;</span><span class="k">then</span> run syno_bootargs<span class="p">;</span>run boot_syno<span class="p">;</span><span class="k">fi</span><span class="p">;</span><span class="k">fi</span><span class="p">;</span>bootr<span class="p">;</span>’
</span></span><span class="line"><span class="cl"> Realtek&gt; saveenv
</span></span><span class="line"><span class="cl"> Saving Environment to FACTORY…
</span></span><span class="line"><span class="cl"> <span class="o">[</span>ENV<span class="o">]</span> Writing to Factory…
</span></span><span class="line"><span class="cl"> <span class="o">[</span>FAC<span class="o">]</span> factory_save: NAND
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">[</span>FAC<span class="o">]</span> Save to nand OK
</span></span><span class="line"><span class="cl"> <span class="k">done</span>
</span></span></code></pre></div><p>可以用print验证，还是那四条必须有</p>
<p>5.启动istore
直接重启机器，U盘在机器上即可进入istore
由于镜像按最小原则设置，默认U盘镜像的overlay可写分区只有2G，可以使用op扩容命令对第三分区进行扩容
第一步，系统安装好后，在主页中，进入“终端”</p>
<p>在“终端”里登录root账号，输入密码</p>
<p>第三步，执行“parted /dev/sdx&quot;命令,其中sdx要改成U盘的盘符</p>
<p>第四步，上面的3就是软件包所在的分区，也就是需要扩容的分区。执行命令“resizepart”，”Partition number? “处输入“3”，然后是“yes&quot;。”End? ? “后面输入需要扩容的大小，也可以直接输入-1MiB,代表使用整个U盘</p>
<p>第五步，输入quit退出</p>
<p>第六步，输入resize2fs -p /dev/sdx3，执行resize2fs对文件系统进行扩容</p>
<p>重启后可以看到可以使用分区大小变成U盘实际大小，愉快的使用docker等功能</p>
<p>6.启动群晖</p>
<ul>
<li>下载网盘中不拆机文件夹中的ds218hdd.bin.gz，不用解压，再次使用balancetcher直接写入要使用的群晖硬盘中
（linux下可以直接dd命令还原<code>gzip -dc ds218hdd.bin.gz | dd of=/dev/sda</code>，win用户请忽略本括号）</li>
<li>将引导U盘插入电脑，打开第一个盘符，任意改名istore文件夹
插上U盘和硬盘，开机即可进入群晖（需要说明的是首次启动可能需要10分钟，耐心等6分钟以后再访问）正常会进入首次启动界面
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=14aa375e22b11065d893f3798e329df0">
如果你进入了找不到硬盘界面，请换个曹位再通电。</li>
</ul>
<p>7.三个系统切换总结为，不插U盘启动原厂；插入U盘就启动istore；如果将istore文件夹改名，就启动群晖。需要说明的是由于没有拆机无法刷uboot，原机器的uboot和群晖系统均不支持pwm，所以，这种方案的风扇是全速的，并且不可调。</p>
<h1 id="刷机方案2硬改spi方案">
  刷机方案2（硬改spi方案）
  <a class="heading-link" href="#%e5%88%b7%e6%9c%ba%e6%96%b9%e6%a1%882%e7%a1%ac%e6%94%b9spi%e6%96%b9%e6%a1%88">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<h3 id="拆机流程">
  拆机流程
  <a class="heading-link" href="#%e6%8b%86%e6%9c%ba%e6%b5%81%e7%a8%8b">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>该需要拆机，机器做工很好，很难拆，附上拆机方案，仍需要一定耐心和动手能力</p>
<ol>
<li>拧下后面板的四个六角螺丝，取下后面板
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=67071003507ea636d2a3b49ba4681a3d"></li>
<li>拧开左右侧盖固定螺丝
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=98c7aa29bd45d2b415d865a8317c3b63"></li>
<li>取下远离主板侧盖（前视右侧盖板，后视左侧盖板），这个盖板只有两个卡笋在如图位置，需要用薄一点的撬片往上撬，卡笋松开后能听到声音，然后向后面板方向推，即可取下该侧板
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=149265f1ace76cbfe2856bdec22eb083"></li>
<li>拧下硬盘笼与另一侧盖板的固定螺丝，连同前面板、主板、硬盘笼一同从另一侧盖板中取出
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=5fe6aac6407d2ee47a1b71a5899cd0cd">
主义取下螺丝后，前面板（包括主板和硬盘笼）与该侧板还有一处卡笋，需要边慢慢用力把侧板向两侧掰，一遍适当用力分离前面板和侧板
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=8c4500267329da3e109cab4253bb1af2"></li>
<li>硬盘笼取出是这个样子，然后主板固定螺丝拧下，就能取下主板
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=77400b1110e5f9ad1b8af611b5082d58"></li>
<li>主板图
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=ef57d682a7f57f7c2dc915f3f6b8b532"></li>
</ol>
<h3 id="ttl接法非必须可用于折腾研究救砖">
  TTL接法（非必须，可用于折腾，研究，救砖）
  <a class="heading-link" href="#ttl%e6%8e%a5%e6%b3%95%e9%9d%9e%e5%bf%85%e9%a1%bb%e5%8f%af%e7%94%a8%e4%ba%8e%e6%8a%98%e8%85%be%e7%a0%94%e7%a9%b6%e6%95%91%e7%a0%96">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>1.通过ttl（usb转uart，3.3v）连接机器，并将ttl插入电脑，使用设备管理器查看串口号
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=ab7460b36bf615fc3efa5ce2d31943f0">
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=a9bf807848e2e8842f4b451d50a3c24d">
2.使用串口软件（包括不限于putty，Xshell等）演示以putty为例，波特率115200，8N1
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=b0bb63788cd51362baea0d811401327a">
3.主板上电开机（注意，如果你主板没有接开关面板将会直接关机，请连接前面板通电）会直接进入openwrt后台，回车激活控制台
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=8579b9736805aff2c32e8b0e55d2c636"></p>
<h3 id="定制固件">
  定制固件
  <a class="heading-link" href="#%e5%ae%9a%e5%88%b6%e5%9b%ba%e4%bb%b6">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ol>
<li>准备spi芯片，w25q64fv或者w25q64jv，用编程器配合软件读取芯片的uid
最简单的编程器如下图，ch341可以用，某宝带编程夹子20左右
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=9ab7e6e9287576830017ee9b6b850882">
连接好编程器和芯片（也可以先焊接）使用编程器软件（链接：https://pan.baidu.com/s/1obRcF68Cvojy42t4ujLADg?pwd=ch39
提取码：ch39）直接读取uid
运行编程器工具
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=5555f8e2b7dd2243b7eea78a879861cc">
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=2b44761b98e5f955005ab2d96516b57c">
选择工具脚本目录下的read_w25_UID.pas
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=71eae2faa4daf5dd64d031f1ec1dd815">
选择区段
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=24eb527cc1c419b88cc9a5c5c414a699">
点击运行，在下面的窗口能看到uid
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=7b2c7487c1c75c749a83dccb46bdaaa6"></li>
<li>提供uid给稍息，制作spi固件</li>
<li>将固件用编程器软件写入
打开编程对应的编程软件，基本步骤为识别-擦除-查空-编程
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=a2a9c6d7b012953556e4870a8425d2e2"></li>
</ol>
<h3 id="硬改流程">
  硬改流程
  <a class="heading-link" href="#%e7%a1%ac%e6%94%b9%e6%b5%81%e7%a8%8b">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ol>
<li>按照拆机主板图将上述spi芯片焊接到主板</li>
<li>修改启动顺序，使芯片从spi启动
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=30cbba43f69bbcd6e3a61a3438eb46fa">
完成上述硬改，即可启动群晖</li>
</ol>
<h2 id="硬改方案启动其它系统">
  硬改方案启动其它系统
  <a class="heading-link" href="#%e7%a1%ac%e6%94%b9%e6%96%b9%e6%a1%88%e5%90%af%e5%8a%a8%e5%85%b6%e5%ae%83%e7%b3%bb%e7%bb%9f">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h4 id="spi方案自动刷入nand铁威马并启动nand铁威马">
  spi方案自动刷入nand铁威马并启动nand铁威马
  <a class="heading-link" href="#spi%e6%96%b9%e6%a1%88%e8%87%aa%e5%8a%a8%e5%88%b7%e5%85%a5nand%e9%93%81%e5%a8%81%e9%a9%ac%e5%b9%b6%e5%90%af%e5%8a%a8nand%e9%93%81%e5%a8%81%e9%a9%ac">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>1.将afw，comix4tos.dtb，initrd，kernel，shaoxi_rtd129x_boot.scr五个文件放入fat32单分区的U盘
前四个文件与不是spi引导方案通用，见群文件
<a href="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&amp;sign=a0b198d6c6feb32909ec46336719177c" title="[nandtos_shaoxi_rtd129x_boot.zip"  class="external-link" target="_blank" rel="noopener">nandtos_shaoxi_rtd129x_boot.zip</a>解压并重命名为shaoxi_rtd129x_boot.scr
2.插入U盘，按住reset，然后通电，待电源指示灯闪烁即可松开reset
3.机器会自动刷nand，自动重启，等待3到5分钟即可启动铁威马
需要注意的是，以上U盘操作只需要一次，刷入完成后不再需要U盘。请及时拔掉。
其他：启动tos后U盘不好用，是由于铁威马的led驱动时写死的gpio，dtb改不了，而铁威马的led驱动与齐心的U盘供电刚好有冲突，解决方案，ssh登录到铁威马后台，运行rm /lib/modules/4.4.18-g8bcbd8a-dirty/led_drv_rtd1296.ko,删除这个led指示灯驱动即可。</p>
<h4 id="spi方案启动u盘istore">
  spi方案启动U盘istore
  <a class="heading-link" href="#spi%e6%96%b9%e6%a1%88%e5%90%af%e5%8a%a8u%e7%9b%98istore">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>可选方案1：按照刷机方案一的第4步，手动命令开始，后面步骤通用spi方案和原厂方案。
可选方案2：</p>
<h4 id="spi方案恢复启动群晖">
  spi方案恢复启动群晖
  <a class="heading-link" href="#spi%e6%96%b9%e6%a1%88%e6%81%a2%e5%a4%8d%e5%90%af%e5%8a%a8%e7%be%a4%e6%99%96">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h4>
<p>不管spi方案改了启动nand铁威马还是U盘istore，都可以脚本恢复默认启动群晖
只需要把<a href="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&amp;sign=fea2d71bbc8e9deb811abb9efe354267" title="[default-shaoxi_rtd129x_boot.zip"  class="external-link" target="_blank" rel="noopener">default-shaoxi_rtd129x_boot.zip</a>解压获得default_shaoxi_rtd129x_boot.scr,将其改名为shaoxi_rtd129x_boot.scr,放入U盘，按住reset，然后通电，待电源指示灯闪烁即可松开reset，会自动恢复启动spi群晖</p>
<h1 id="群晖系统spi和u盘通用启动后优化">
  群晖系统（spi和U盘通用）启动后优化
  <a class="heading-link" href="#%e7%be%a4%e6%99%96%e7%b3%bb%e7%bb%9fspi%e5%92%8cu%e7%9b%98%e9%80%9a%e7%94%a8%e5%90%af%e5%8a%a8%e5%90%8e%e4%bc%98%e5%8c%96">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>1.由于风扇的pwm引脚在常电区，且群晖不支持pwm，为了保证风扇pwm可调，我在uboot中设置转速为40%，群晖系统不再进行管理，所以默认关机也不会关闭风扇，可以配合脚本实现关机自动关风扇。
控制面板-任务计划-新增-触发的任务-用户自定义的脚本
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=19e0d682a183d112d411fd9dfd2d4fc8">
在事件中选择关机，用户选择root
<img src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=4f590c033a70ca9c208759338728e9c5">
关机脚本中填入</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">123</span> &gt; /sys/class/gpio/export
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> out &gt; /sys/class/gpio/gpio123/direction
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">0</span> &gt; /sys/class/gpio/gpio123/value
</span></span></code></pre></div><p>2.优化关闭不必要功能，可选，不影响使用
在群晖控制面板开启ssh
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=6c77485012862b119a01ea98c3b677b3">
使用ssh软件登录群晖，并切换到root用户
<code>sudo -i</code>
执行下列命令，主要是重定位日志到内存，关闭蜂鸣器、风扇、led等群晖靠mcu控制的功能，开启网络唤醒，关闭磁盘兼容性检查，根据实际需要运行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/\/var\/log\/scemd.log/\/tmp\/scemd.log/g&#39;</span> /etc.defaults/syslog-ng/patterndb.d/scemd.conf
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/support_buzzer=&#34;yes&#34;/support_buzzer=&#34;no&#34;/g&#39;</span> /etc.defaults/synoinfo.conf
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/support_fan=&#34;yes&#34;/support_fan=&#34;no&#34;/g&#39;</span> /etc.defaults/synoinfo.conf
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/enable_fan_debug=&#34;0x0&#34;/enable_fan_debug=&#34;0x1&#34;/g&#39;</span> /etc.defaults/synoinfo.conf
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/support_fan_adjust_dual_mode=&#34;yes&#34;/support_fan_adjust_dual_mode=&#34;no&#34;/g&#39;</span> /etc.defaults/synoinfo.conf
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/support_wol=&#34;no&#34;/support_wol=&#34;yes&#34;/g&#39;</span> /etc.defaults/synoinfo.conf
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/support_led_behavior_v2=&#34;yes&#34;/support_led_behavior_v2=&#34;no&#34;/g&#39;</span> /etc.defaults/synoinfo.conf
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/support_led_brightness_adjustment=&#34;yes&#34;/support_led_brightness_adjustment=&#34;no&#34;/g&#39;</span> /etc.defaults/synoinfo.conf
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/support_disk_compatibility=&#34;yes&#34;/support_disk_compatibility=&#34;no&#34;/g&#39;</span> /etc.defaults/synoinfo.conf
</span></span></code></pre></div><ol>
<li>洗白
注意，洗白仅支持spi方案，也就是刷机方案2
方法1：可以直接使用矿神的cm360一键洗白脚本https://imnks.com/7267.html
方法2：手动修改
在编程器固件偏移量0x7ef000，第一行市前6字节是mac,后面跟着校验和（可能是一字节或两字节），第四行市sn的ascii码和校验和的ascii码。mac和sn的校验和计算方法与其它型号通用。我直接引用一张别的机器的计算方法图。替换后，再刷一遍就行了。
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=8bbfd98ccf0c824538459e5b42a3afab">
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=e0d35ff053293db9ed658b725d8803a1">
经测试，换了ds218的sn后，可以qc，可以硬件转码，怎么获得sn就八仙过海各显神通了。
方法3：直接使用矿渣论坛 “kuangzha”的<a href="https://bbs.nas66.com/forum.php?mod=viewthread&amp;tid=10997&amp;highlight=%e7%8c%ab%e7%9b%98%e7%be%a4%e6%99%96%e8%b6%85%e7%ba%a7%e7%ae%80%e5%8d%95%e4%bf%ae%e6%94%b9%e3%80%90SN%2BMAC%e3%80%91%2B%e5%b7%a5%e5%85%b73.0"  class="external-link" target="_blank" rel="noopener">“猫盘群晖超级简单修改【SN MAC】 工具3.0”</a>”，经验证，方法和教程可用与本机器。</li>
</ol>
<h1 id="其他进阶教程没有变砖不用看">
  其他进阶教程（没有变砖不用看）
  <a class="heading-link" href="#%e5%85%b6%e4%bb%96%e8%bf%9b%e9%98%b6%e6%95%99%e7%a8%8b%e6%b2%a1%e6%9c%89%e5%8f%98%e7%a0%96%e4%b8%8d%e7%94%a8%e7%9c%8b">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<h3 id="线刷教程可用于写入bootloader救砖原厂bootloader文件在网盘里">
  线刷教程（可用于写入bootloader，救砖）原厂bootloader文件在网盘里
  <a class="heading-link" href="#%e7%ba%bf%e5%88%b7%e6%95%99%e7%a8%8b%e5%8f%af%e7%94%a8%e4%ba%8e%e5%86%99%e5%85%a5bootloader%e6%95%91%e7%a0%96%e5%8e%9f%e5%8e%82bootloader%e6%96%87%e4%bb%b6%e5%9c%a8%e7%bd%91%e7%9b%98%e9%87%8c">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>1.下载<a href="https://download.banana-pi.dev/d/ca025d76afd448aabc63/files/?p=%2FTools%2Fimage_download_tools%2Fw2_android_usb_download_tool.zip"  class="external-link" target="_blank" rel="noopener">bpi-w2刷机工具</a>
2.安装驱动，在工具目录下，已经装过的不用二次安装
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=2d4c01a79b196a3f81be3c3bf21993f4">
3.关闭刷机软件情况下，将要刷写的uboot重命名为bootloader.tar,并覆盖刷机软件Tempfile下的bootloader.tar后再打开软件
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=1b4f9c98d6c30dd052e93e09f642464a">
4.软件操作顺序</p>
<ul>
<li>选择刷nand</li>
<li>选择ddr类型2ddr3_1G</li>
<li>不要选择镜像文件,不要选择镜像文件
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=8c2d44daf993f7ccd4a86117d71607d0"></li>
<li>设置刷写选项，勾选”only upgrade bootloader”
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=78ab2e4ab1995bf5d820185985f27adf">
5.启动刷机</li>
<li>短接SW1（拆机图中的开关）插入双公头usb线（一头电脑，一头接主板靠近reset的usb口）此时刷机工具会有反应（不用插电）
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=a9589d2de8781f3be3093e1794b763f0"></li>
<li>点击绿色小人开始刷机，一定要等到这个图标后再过一分钟（原因未知，太早拔线uboot无法启动）
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=a34bd6f7943fa278e1d59a0740d86f21">
如果你此时连接了ttl，后台看到的nand读写是这样的，如果没有ttl请忽略
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=d37c59e228747381cd4595e1a9e5aae7"></li>
</ul>
<p>需要注意的是，如果你多次尝试线刷，始终显示进度为0，后台ttl显示的spi init，就没反映了
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=9f422094c0188dda0a4c1c5e61297abf">
因为短接开关默认启动spi，刷机默认是spi，这时候可以ttl下用nand erase 擦除nand boot再线刷，此时就不用短接按键，默认进入线刷模式</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Realtek&gt; nand erase 0xc0000 0x480000
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAND erase: device <span class="m">0</span> offset 0x0, size 0x480000
</span></span><span class="line"><span class="cl">Erasing at 0x520000 -- 100% complete.
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">Realtek&gt;
</span></span></code></pre></div><p><img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=fb3905ef581505032baef97329323523">
切记不能擦除0x0000-0x20000的空间，这里放着flash识别信息（就是flash的基本信息），bootrom启动的时候需要读取，如果错误擦除，就算线刷也无法启动uboot，需要用ctrl+q模式救砖
（对于完整刷机包,就直接选择刷机包就行，不过nand方案没有看到过刷机包）</p>
<h3 id="ctrl-q模式终极救砖">
  ctrl-q模式终极救砖
  <a class="heading-link" href="#ctrl-q%e6%a8%a1%e5%bc%8f%e7%bb%88%e6%9e%81%e6%95%91%e7%a0%96">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ol>
<li>
<p>下载软件包，包括hw，uboot和串口工具（必须使用win的hyperterm，其他串口工具在该模式下传输均失败）</p>
</li>
<li>
<p>按照上文所述连接电脑和板子的ttl</p>
</li>
<li>
<p>运行hyperterm，设置串口号和参数
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=ea7a7ca6995cccab283c1aa0d4b4fb80"></p>
</li>
<li>
<p>同时按住ctrl键和q键，同时插入电源，进入bootrom模式，当终端界面出现’ d/g/r ‘ 后就松掉
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=7072b0fe7b43963a4dea5dc72ba3e33e"></p>
</li>
<li>
<p>输入 “h” 然后发送硬件配置二进制文件 (01hwsetting) 在 Y-modem 模式
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=20e8bcf71a0315be06e53465b8512e5a"></p>
</li>
<li>
<p>等待传输完成, 然后输入下面的参数:</p>
<pre tabindex="0"><code>s
98007058
00020000
</code></pre></li>
<li>
<p>输入d，同样用y-moderm传送02uboot
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=56e6923e92ac08818b933b1d3ceef0bc"></p>
</li>
<li>
<p>传输完成后，输入g即可运行uboot，同时立即连续按住esc，确保中断uboot
<img alt="img" src="https://home.urvip.top:1443/showdoc/server/index.php?s=/api/attachment/visitFile&sign=ddba2c88e6c2fd24fc24bd881a35a8b3"></p>
</li>
<li>
<p>使用uboot的nand命令重新写入原来的备份的boot_mtd.bin</p>
<p>可以使用loady命令直接串口加载</p>
<p>或者放入U盘，使用</p>
<pre tabindex="0"><code>usb start;fatload usb 0 0x3000000 boot_mtd.bin
</code></pre><p>命令从U盘加载，结构都是将这个文件加载到了内存的0x3000000这给位置</p>
<p>然后使用nand命令写入nand的0x0位置，大小为0x4c0000,命令为</p>
<pre tabindex="0"><code>nand erase 0x0 0x4c0000
nand write 0x3000000 0x0 0x4c0000
</code></pre><p>完成后即可断电重启，或者使用reset命令重启，救砖完成，又可以线刷或者uboot设置了</p>
</li>
</ol>

  </article>
</section>

  

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      2020 -
    
    2025
     WM 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/504/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  
<script defer src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "6063d19bd87b447a928874bbd4bbe1dc"}'></script>



  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
